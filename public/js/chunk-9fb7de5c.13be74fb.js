(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9fb7de5c"],{"8cf7":function(e,t,r){"use strict";r.r(t);r("2482"),r("2445"),r("89b9");var a=function(){var e=this,t=e._self._c;return t("d2-container",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h2",[e._v("用户订单列表")])]},proxy:!0}])},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"sort-change":e.handleSortChange}},[t("el-table-column",{attrs:{prop:"picture",label:"商品图片",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(e){return[0===e.$index?t("div"):t("div",[t("img",{staticStyle:{width:"100%",height:"80px"},attrs:{src:e.row.commodity_info.image_url}})])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"商品名称",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询商品名称"},on:{change:e.queryOrdersByCommodityName},model:{value:e.query.commodityName,callback:function(t){e.$set(e.query,"commodityName",t)},expression:"query.commodityName"}})],1):t("div",[t("el-row",[e._v(e._s(r.row.commodity_info.name))]),t("el-row",{staticStyle:{"margin-top":"10px"}},e._l(r.row.selected_options,(function(r,a){return t("el-tag",{key:a,staticStyle:{"margin-left":"10px"},attrs:{size:"mini"}},[e._v(" "+e._s(r)+" ")])})),1)],1)]}}])}),t("el-table-column",{attrs:{prop:"num",label:"购买数量",sortable:"custom",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询数量"},on:{change:e.queryOrdersByNum},model:{value:e.query.num,callback:function(t){e.$set(e.query,"num",t)},expression:"query.num"}})],1):t("div",[e._v(" "+e._s(r.row.num)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"price",sortable:"custom",label:"实付金额",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询金额"},on:{change:e.queryOrdersByPrice},model:{value:e.query.price,callback:function(t){e.$set(e.query,"price",t)},expression:"query.price"}})],1):t("div",[e._v(" "+e._s("¥"+r.row.price)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"店铺名",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询店铺名"},on:{change:e.queryOrdersByShopName},model:{value:e.query.shopName,callback:function(t){e.$set(e.query,"shopName",t)},expression:"query.shopName"}})],1):t("div",[e._v(" "+e._s(r.row.commodity_info.shop_name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"交易状态",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},on:{change:e.queryOrdersByStatus},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},[t("el-option",{attrs:{label:"已下单",value:0}}),t("el-option",{attrs:{label:"已支付",value:1}}),t("el-option",{attrs:{label:"已发货",value:2}}),t("el-option",{attrs:{label:"已收货",value:3}}),t("el-option",{attrs:{label:"已评价",value:4}}),t("el-option",{attrs:{label:"已关闭",value:5}})],1)],1):t("div",[5!==r.row.status?t("el-steps",{staticStyle:{"margin-left":"20px","margin-right":"10px"},attrs:{space:200,active:r.row.status+1,"finish-status":"success"}},[t("el-step",{attrs:{title:"下单"}}),t("el-step",{attrs:{title:"支付"}}),t("el-step",{attrs:{title:"发货"}}),t("el-step",{attrs:{title:"收货"}}),t("el-step",{attrs:{title:"评价"}})],1):t("div",[e._v("订单已经关闭")])],1)]}}])}),t("el-table-column",{attrs:{prop:"start_time",sortable:"custom",label:"下单时间",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:e.queryOrdersByStartTime},model:{value:e.query.startTime,callback:function(t){e.$set(e.query,"startTime",t)},expression:"query.startTime"}})],1):t("div",[e._v(" "+e._s(e.formatTime(r.row.start_time))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div"):t("div",[t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.getOrderDetails(r.row.id)}}},[e._v("查看详情")])],1),0===r.row.status?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.closeOrder(r.row.id)}}},[e._v("撤销订单")])],1):e._e(),0===r.row.status?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.payOrder(r.row.id)}}},[e._v("支付订单")])],1):e._e(),2===r.row.status?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.confirmOrder(r.row.id)}}},[e._v("确认收货")])],1):e._e(),3===r.row.status?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){e.modal=!0,e.orderToComment=r.row.id}}},[e._v("去评价")])],1):e._e()],1)]}}])})],1),t("div",{staticClass:"block",staticStyle:{"margin-top":"10px"}},[t("el-pagination",{staticStyle:{"text-align":"center"},attrs:{hi:"",background:"",layout:"prev, pager, next,jumper, ->, total, slot",total:e.filterTotalCnt,"current-page":e.currentPage,"page-size":10},on:{"current-change":e.handleCurrentChange}})],1),t("el-drawer",{attrs:{title:"订单详情",visible:e.drawer,direction:"rtl"},on:{"update:visible":function(t){e.drawer=t}}},[t("img",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{src:e.curOrderDetails.commodity_info?e.curOrderDetails.commodity_info.image_url:null,alt:""}}),t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 商品名称 ")]),e._v(" "+e._s(e.curOrderDetails.commodity_info?e.curOrderDetails.commodity_info.name:null)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 店铺名称 ")]),e._v(" "+e._s(e.curOrderDetails.commodity_info?e.curOrderDetails.commodity_info.shop_name:null)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 所选选项 ")]),void 0===e.curOrderDetails.selected_options||0===e.curOrderDetails.selected_options.length?t("div",[e._v(" 无")]):t("div",e._l(e.curOrderDetails.selected_options,(function(r,a){return t("el-tag",{key:a,staticStyle:{"margin-right":"10px"},attrs:{size:"mini"}},[e._v(" "+e._s(r.description)+" ")])})),1)],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 购买数量 ")]),e._v(" "+e._s(e.curOrderDetails.num)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 购买金额 ")]),e._v(" "+e._s("¥"+e.curOrderDetails.price)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 交易状态 ")]),0==e.curOrderDetails.status?t("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("已下单")]):e._e(),1==e.curOrderDetails.status?t("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v("已支付")]):e._e(),2==e.curOrderDetails.status?t("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("已发货")]):e._e(),3==e.curOrderDetails.status?t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("已收货")]):e._e(),4==e.curOrderDetails.status?t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("已评价")]):e._e(),5==e.curOrderDetails.status?t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("已关闭")]):e._e()],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 交易地址 ")]),e._v(" "+e._s(null===e.curOrderDetails.address?"无":e.curOrderDetails.address)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 备注 ")]),e._v(" "+e._s(null===e.curOrderDetails.note?"无":e.curOrderDetails.note)+" ")],2),e.curOrderDetails.status>=0?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 下单时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.start_time?"无":e.formatTime(e.curOrderDetails.start_time))+" ")],2):e._e(),e.curOrderDetails.status>=1&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 支付时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.pay_time?"无":e.formatTime(e.curOrderDetails.pay_time))+" ")],2):e._e(),e.curOrderDetails.status>=2&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 发货时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.deliver_time?"无":e.formatTime(e.curOrderDetails.deliver_time))+" ")],2):e._e(),e.curOrderDetails.status>=3&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 收货时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.confirm_time?"无":e.formatTime(e.curOrderDetails.confirm_time))+" ")],2):e._e(),5===e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 关闭时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.close_time?"无":e.formatTime(e.curOrderDetails.close_time))+" ")],2):e._e()],1)],1),t("Modal",{attrs:{title:"请输入你的评价"},on:{"on-ok":e.commentOrder},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[t("el-form",{attrs:{model:e.comment}},[t("el-form-item",{attrs:{label:"评分",required:""}},[t("el-rate",{staticStyle:{"margin-top":"10px"},attrs:{"show-text":""},model:{value:e.comment.grade,callback:function(t){e.$set(e.comment,"grade",t)},expression:"comment.grade"}})],1),t("el-form-item",{attrs:{label:"內容"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.comment.content,callback:function(t){e.$set(e.comment,"content",t)},expression:"comment.content"}})],1)],1)],1)],1)},s=[],i=r("d18b"),n=r("56c3"),l=r("da3e"),c=(r("ae26"),r("f7e8"),r("bc59"),r("365c")),o=r("c276"),u={name:"user-orders",data:function(){return{query:{commodityName:"",num:"",price:"",status:"",startTime:"",shopName:""},currentPage:1,filterTotalCnt:0,filter:{},orderBy:{create_time_desc:!0},tableData:[{}],modal:!1,orderToComment:"",comment:{grade:"",content:"",images:[]},drawer:!1,curOrderDetails:{}}},methods:{formatTime:o["a"].time.formatTime,queryOrders:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){var r,a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=Object(n["a"])(Object(n["a"])(Object(n["a"])({},e.filter),e.orderBy),{},{page:e.currentPage}),t.next=3,c["a"].GET_ORDER_LIST_FOR_USER(r);case 3:a=t.sent,console.log(a.data),e.tableData=a.data,e.tableData.unshift({}),e.filterTotalCnt=a.tot_count;case 8:case"end":return t.stop()}}),t)})))()},handleCurrentChange:function(e){this.currentPage=e,this.queryOrders()},handleSortChange:function(e){"num"===e.prop&&("ascending"===e.order?this.orderBy={num_asc:!0}:"descending"===e.order?(this.orderBy="-num",this.orderBy={num_desc:!0}):this.orderBy={create_time_desc:!0}),"price"===e.prop&&("ascending"===e.order?this.orderBy={price_asc:!0}:"descending"===e.order?this.orderBy={price_desc:!0}:this.orderBy={create_time_desc:!0}),"start_time"===e.prop&&("ascending"===e.order?this.orderBy={create_time_asc:!0}:(e.order,this.orderBy={create_time_desc:!0})),console.log(this.orderBy),this.currentPage=1,this.queryOrders()},queryOrdersByCommodityName:function(){""!==this.query.commodityName?Object.assign(this.filter,{commodity_name_fuzzy:this.query.commodityName}):delete this.filter.commodity_name_fuzzy,this.currentPage=1,this.queryOrders()},queryOrdersByNum:function(){""!==this.query.num?Object.assign(this.filter,{num_exact:this.query.num}):delete this.filter.num_exact,this.currentPage=1,this.queryOrders()},queryOrdersByPrice:function(){""!==this.query.price?Object.assign(this.filter,{price_exact:this.query.price}):delete this.filter.price_exact,this.currentPage=1,this.queryOrders()},queryOrdersByShopName:function(){""!==this.query.shopName?Object.assign(this.filter,{shop_name_fuzzy:this.query.shopName}):delete this.filter.shop_name_fuzzy,this.currentPage=1,this.queryOrders()},queryOrdersByStatus:function(){""!==this.query.status?Object.assign(this.filter,{status_exact:this.query.status}):delete this.filter.status_exact,this.currentPage=1,this.queryOrders()},queryOrdersByStartTime:function(){null!==this.query.startTime&&""!==this.query.startTime?Object.assign(this.filter,{create_date:this.query.startTime}):delete this.filter.create_date,this.currentPage=1,this.queryOrders()},getOrderDetails:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.drawer=!0,r.next=3,c["a"].GET_ORDER_DETAILS(e);case 3:t.curOrderDetails=r.sent,console.log(t.curOrderDetails);case 5:case"end":return r.stop()}}),r)})))()},closeOrder:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("是否关闭订单","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});case 2:return r.next=4,c["a"].CLOSE_ORDER(e);case 4:return r.next=6,t.queryOrders();case 6:t.$Message.success("关闭成功！");case 7:case"end":return r.stop()}}),r)})))()},payOrder:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("是否支付订单","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});case 2:return r.next=4,c["a"].PAY_ORDER(e);case 4:return r.next=6,t.queryOrders();case 6:t.$Message.success("支付成功！");case 7:case"end":return r.stop()}}),r)})))()},confirmOrder:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("是否确认收货","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});case 2:return r.next=4,c["a"].CONFIRM_RECEIVED(e);case 4:return r.next=6,t.queryOrders();case 6:t.$Message.success("关闭成功！");case 7:case"end":return r.stop()}}),r)})))()},commentOrder:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==e.comment.grade&&null!==e.comment.grade&&0!==e.comment.grade){t.next=3;break}return e.$Message.error("评分不能为空！"),t.abrupt("return");case 3:return t.next=5,c["a"].SUBMIT_COMMENT(e.orderToComment,e.comment);case 5:return t.next=7,e.queryOrders();case 7:e.$Message.success("评价成功！");case 8:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(l["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.queryOrders();case 2:case"end":return t.stop()}}),t)})))()}},d=u,m=r("e607"),p=Object(m["a"])(d,a,s,!1,null,"c4def26a",null);t["default"]=p.exports},bc59:function(e,t,r){"use strict";var a=r("aea8"),s=r("77ee"),i=r("98f2"),n=r("f4cd"),l=r("2df7"),c=r("97a8"),o=1!==[].unshift(0),u=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();a({target:"Array",proto:!0,arity:1,forced:o||u},{unshift:function(e){var t=s(this),r=i(t),a=arguments.length;if(a){c(r+a);var o=r;while(o--){var u=o+a;o in t?t[u]=t[o]:l(t,u)}for(var d=0;d<a;d++)t[d]=arguments[d]}return n(t,r+a)}})}}]);