(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0efc8f"],{"9a1b":function(e,t,a){"use strict";a.r(t);a("2482");var s=function(){var e=this,t=e._self._c;return t("d2-container",{scopedSlots:e._u([{key:"header",fn:function(){return[t("el-row",[t("el-col",[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.curShopId,callback:function(t){e.curShopId=t},expression:"curShopId"}},e._l(e.shopList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-col",{staticStyle:{"text-align":"center"}},[t("el-avatar",{staticStyle:{"margin-left":"10px"},attrs:{size:150,src:e.shopImg}})],1)],1),t("el-row",[t("el-col",{staticStyle:{"text-align":"center"}},[t("h2",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.curShopDetails.name))])]),t("el-col",{staticStyle:{"text-align":"right","margin-top":"-30px"}},[t("el-upload",{staticClass:"upload-demo",attrs:{headers:{Authorization:"Bearer "+e.token},"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"before-upload":e.beforeImageUpload,"show-file-list":!1,action:"/api/images"}},[t("el-button",{attrs:{size:"mini",type:"success"}},[e._v("上传新头像")])],1)],1)],1)]},proxy:!0}])},[t("el-collapse",{attrs:{value:["1","2","3"]}},[t("el-collapse-item",{attrs:{title:"基本信息",name:"1"}},[t("el-descriptions",{staticClass:"margin-top",attrs:{column:2,border:""}},[t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店铺名 ")]),e._v(" "+e._s(e.curShopDetails.name)+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店铺类型 ")]),e._v(" "+e._s(0===e.curShopDetails.type?"个人店铺":"合作店铺")+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 注册时间 ")]),e._v(" "+e._s(e.formatTime(e.curShopDetails.reg_time))+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店铺评分 ")]),e.curShopDetails.grade?t("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:e.curShopDetails.grade,callback:function(t){e.$set(e.curShopDetails,"grade",t)},expression:"curShopDetails.grade"}}):t("div",[e._v("暂无评分")])],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店铺介绍 ")]),e._v(" "+e._s(""===e.curShopDetails.introduction?"无":e.curShopDetails.introduction)+" ")],2)],1)],1),t("el-collapse-item",{attrs:{title:"店主信息",name:"2"}},[t("el-descriptions",{staticClass:"margin-top",attrs:{column:2,border:""}},[t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店主id ")]),e._v(" "+e._s(e.curShopDetails.owner_info.id)+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店主昵称 ")]),e._v(" "+e._s(e.curShopDetails.owner_info.username)+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店主学号 ")]),e._v(" "+e._s(e.curShopDetails.owner_info.student_id)+" ")],2),t("el-descriptions-item",[t("template",{slot:"label"},[t("i",{staticClass:"el-icon-user"}),e._v(" 店主姓名 ")]),e._v(" "+e._s(e.curShopDetails.owner_info.real_name)+" ")],2)],1)],1),1===e.curShopDetails.type?t("el-collapse-item",{attrs:{title:"管理员信息",name:"3"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{border:"","highlight-current-row":"",data:e.curShopDetails.managers}},[t("el-table-column",{attrs:{prop:"student_id",align:"center",label:"管理员学号"}}),t("el-table-column",{attrs:{prop:"real_name",align:"center",label:"管理员姓名"}}),t("el-table-column",{attrs:{prop:"username",align:"center",label:"管理员用户名"}})],1),t("br"),t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"success"},on:{click:e.addAdmin}},[e._v("增加管理员")]),t("el-button",{attrs:{type:"danger"},on:{click:e.deleteAdmin}},[e._v("删除管理员")])],1)],1):e._e()],1)],1)},r=[],n=a("d18b"),o=a("da3e"),i=(a("8cd1"),a("b141"),a("365c")),l=a("c276"),c={name:"shop-details",data:function(){return{token:l["a"].cookies.get("token"),userId:this.$store.state.d2admin.user.info.id,shopList:[],owningShopList:[],managingShopList:[],curShopId:0,curShopDetails:{}}},computed:{shopImg:function(){return null==this.curShopDetails.image_url?"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png":this.curShopDetails.image_url}},methods:{formatTime:l["a"].time.formatTime,getShopList:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i["a"].GET_USER_SHOP_LIST(e.userId);case 2:a=t.sent,e.owningShopList=a.owning_shops,e.managingShopList=a.managing_shops,e.shopList=e.owningShopList.concat(e.managingShopList),console.log(e.shopList);case 7:case"end":return t.stop()}}),t)})))()},getShopDetails:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){var a;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i["a"].GET_SHOP_DETAILS(e.curShopId);case 2:a=t.sent,e.curShopDetails=a,console.log(a);case 5:case"end":return t.stop()}}),t)})))()},addAdmin:function(){var e=this;this.$prompt("请输入要添加的管理员学号","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){i["a"].ADD_SHOP_ADMIN(e.curShopId,t.value).then((function(){e.$Message.success("添加成功！"),e.getShopDetails()})).catch((function(t){"only the owner can add an manager"===t.response.data.error?e.$Message.error("只有店主才能添加管理员"):"the owner cannot become the manager"===t.response.data.error?e.$Message.error("店主不能成为管理员"):"the student is already a manager of the store"===t.response.data.error?e.$Message.error("不能重复添加"):e.$Message.error("学号不存在")}))}))},deleteAdmin:function(){var e=this;this.$prompt("请输入要删除的管理员学号","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(t){i["a"].DELETE_SHOP_ADMIN(e.curShopId,t.value).then((function(){e.$Message.success("删除成功！"),e.getShopDetails()})).catch((function(t){"only the owner can delete an manager"===t.response.data.error?e.$Message.error("只有店主才能删除管理员"):"the owner cannot become the manager"===t.response.data.error?e.$Message.error("店主不能成为管理员"):"the student is not a manager of the shop"===t.response.data.error?e.$Message.error("该学生不是当前店铺的管理员"):e.$Message.error("学号不存在")}))}))},handleUploadSuccess:function(e,t){var a=this;return Object(o["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i["a"].SET_SHOP_IMG(e.id,a.curShopId);case 2:return a.$Message.success("上传成功！"),t.next=5,a.getShopDetails();case 5:case"end":return t.stop()}}),t)})))()},handleUploadError:function(e,t){this.$Message.error("上传失败！")},beforeImageUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<2;return t||this.$Message.error("上传图片只能是 JPG/PNG 格式!"),a||this.$Message.error("上传图片大小不能超过 2MB!"),t&&a}},watch:{curShopId:{handler:function(e){this.getShopDetails()}}},mounted:function(){var e=this;return Object(o["a"])(Object(n["a"])().mark((function t(){return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getShopList();case 2:if(0!==e.shopList.length){t.next=8;break}return t.next=5,e.$router.push({path:"/shop/create"});case 5:e.$Message.warning("您还没有创建店铺!"),t.next=11;break;case 8:return e.curShopId=e.shopList[0].id,t.next=11,e.getShopDetails();case 11:case"end":return t.stop()}}),t)})))()}},u=c,p=a("e607"),h=Object(p["a"])(u,s,r,!1,null,"374f148c",null);t["default"]=h.exports}}]);