(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43b2e678"],{9384:function(e,t,r){"use strict";r.r(t);r("2482");var s=function(){var e=this,t=e._self._c;return t("d2-container",{scopedSlots:e._u([{key:"header",fn:function(){return[t("el-form",{ref:"form",attrs:{"label-width":"100px"}},[t("el-form-item",{staticStyle:{height:"10px"},attrs:{label:"请选择店铺"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.curShopId,callback:function(t){e.curShopId=t},expression:"curShopId"}},e._l(e.shopList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)]},proxy:!0}])},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"sort-change":e.handleSortChange}},[t("el-table-column",{attrs:{prop:"picture",label:"商品图片",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(e){return[0===e.$index?t("div"):t("div",[t("img",{staticStyle:{width:"100%",height:"80px"},attrs:{src:e.row.commodity_info.image_url}})])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"商品名称",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询商品名称"},on:{change:e.queryOrdersByCommodityName},model:{value:e.query.commodityName,callback:function(t){e.$set(e.query,"commodityName",t)},expression:"query.commodityName"}})],1):t("div",[t("el-row",[e._v(e._s(r.row.commodity_info.name))]),t("el-row",{staticStyle:{"margin-top":"10px"}},e._l(r.row.selected_options,(function(r){return t("el-tag",{key:r.id,staticStyle:{"margin-left":"10px"},attrs:{size:"mini"}},[e._v(" "+e._s(r)+" ")])})),1)],1)]}}])}),t("el-table-column",{attrs:{prop:"num",label:"购买数量",sortable:"custom",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询数量"},on:{change:e.queryOrdersByNum},model:{value:e.query.num,callback:function(t){e.$set(e.query,"num",t)},expression:"query.num"}})],1):t("div",[e._v(" "+e._s(r.row.num)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"price",sortable:"custom",label:"实付金额",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询金额"},on:{change:e.queryOrdersByPrice},model:{value:e.query.price,callback:function(t){e.$set(e.query,"price",t)},expression:"query.price"}})],1):t("div",[e._v(" "+e._s("¥"+r.row.price)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"买家用户名",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-input",{attrs:{size:"small",placeholder:"查询用户名"},on:{change:e.queryOrdersByUsername},model:{value:e.query.username,callback:function(t){e.$set(e.query,"username",t)},expression:"query.username"}})],1):t("div",[e._v(" "+e._s(r.row.user_info.username)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",label:"交易状态",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},on:{change:e.queryOrdersByStatus},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},[t("el-option",{attrs:{label:"已下单",value:0}}),t("el-option",{attrs:{label:"已支付",value:1}}),t("el-option",{attrs:{label:"已发货",value:2}}),t("el-option",{attrs:{label:"已收货",value:3}}),t("el-option",{attrs:{label:"已评价",value:4}}),t("el-option",{attrs:{label:"已关闭",value:5}})],1)],1):t("div",[5!==r.row.status?t("el-steps",{staticStyle:{"margin-left":"20px","margin-right":"10px"},attrs:{space:200,active:r.row.status+1,"finish-status":"success"}},[t("el-step",{attrs:{title:"下单"}}),t("el-step",{attrs:{title:"支付"}}),t("el-step",{attrs:{title:"发货"}}),t("el-step",{attrs:{title:"收货"}}),t("el-step",{attrs:{title:"评价"}})],1):t("div",[e._v("订单已经关闭")])],1)]}}])}),t("el-table-column",{attrs:{prop:"start_time",sortable:"custom",label:"下单时间",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div",[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:e.queryOrdersByStartTime},model:{value:e.query.startTime,callback:function(t){e.$set(e.query,"startTime",t)},expression:"query.startTime"}})],1):t("div",[e._v(" "+e._s(e.formatTime(r.row.start_time))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"picture",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(r){return[0===r.$index?t("div"):t("div",[t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.getOrderDetails(r.row.id)}}},[e._v("查看详情")])],1),1===r.row.status?t("el-row",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deliverCommodity(r.row.id)}}},[e._v("发货")])],1):e._e()],1)]}}])})],1),t("div",{staticClass:"block",staticStyle:{"margin-top":"10px"}},[t("el-pagination",{staticStyle:{"text-align":"center"},attrs:{hi:"",background:"",layout:"prev, pager, next,jumper, ->, total, slot",total:e.filterTotalCnt,"current-page":e.currentPage,"page-size":10},on:{"current-change":e.handleCurrentChange}})],1),t("el-drawer",{attrs:{title:"订单详情",visible:e.drawer,direction:"rtl"},on:{"update:visible":function(t){e.drawer=t}}},[t("img",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{src:e.curOrderDetails.image_url,alt:""}}),t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 商品名称 ")]),e._v(" "+e._s(e.curOrderDetails.commodity_info?e.curOrderDetails.commodity_info.name:null)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 店铺名称 ")]),e._v(" "+e._s(e.curOrderDetails.commodity_info?e.curOrderDetails.commodity_info.shop_name:null)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 购买数量 ")]),e._v(" "+e._s(e.curOrderDetails.num)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 购买金额 ")]),e._v(" "+e._s("¥"+e.curOrderDetails.price)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 交易状态 ")]),0==e.curOrderDetails.status?t("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("已下单")]):e._e(),1==e.curOrderDetails.status?t("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v("已支付")]):e._e(),2==e.curOrderDetails.status?t("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v("已发货")]):e._e(),3==e.curOrderDetails.status?t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("已收货")]):e._e(),4==e.curOrderDetails.status?t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("已评价")]):e._e(),5==e.curOrderDetails.status?t("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("已关闭")]):e._e()],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 交易地址 ")]),e._v(" "+e._s(""===e.curOrderDetails.address?"无":e.curOrderDetails.address)+" ")],2),t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 备注 ")]),e._v(" "+e._s(""===e.curOrderDetails.note?"无":e.curOrderDetails.note)+" ")],2),e.curOrderDetails.status>=0?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 下单时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.start_time?"无":e.formatTime(e.curOrderDetails.start_time))+" ")],2):e._e(),e.curOrderDetails.status>=1&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 支付时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.pay_time?"无":e.formatTime(e.curOrderDetails.pay_time))+" ")],2):e._e(),e.curOrderDetails.status>=2&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 发货时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.deliver_time?"无":e.formatTime(e.curOrderDetails.deliver_time))+" ")],2):e._e(),e.curOrderDetails.status>=3&&5!==e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 收货时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.confirm_time?"无":e.formatTime(e.curOrderDetails.confirm_time))+" ")],2):e._e(),5===e.curOrderDetails.status?t("el-descriptions-item",{attrs:{span:2}},[t("template",{slot:"label"},[e._v(" 关闭时间 ")]),e._v(" "+e._s(null===e.curOrderDetails.close_time?"无":e.formatTime(e.curOrderDetails.close_time))+" ")],2):e._e()],1)],1)],1)},a=[],i=r("56c3"),n=r("d18b"),l=r("da3e"),c=(r("8cd1"),r("ae26"),r("f7e8"),r("bc59"),r("b141"),r("365c")),u=r("c276"),o={name:"shop-orders",data:function(){return{userId:this.$store.state.d2admin.user.info.id,shopList:[],curShopId:0,drawer:!1,curOrderDetails:{},query:{commodityName:"",num:"",price:"",status:"",startTime:"",username:""},currentPage:1,filterTotalCnt:0,filter:{},orderBy:{create_time_desc:!0},tableData:[{}]}},methods:{formatTime:u["a"].time.formatTime,getShopList:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["a"].GET_USER_SHOP_LIST(e.userId);case 2:r=t.sent,e.shopList=r.owning_shops.concat(r.managing_shops);case 4:case"end":return t.stop()}}),t)})))()},queryOrders:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var r,s;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=Object(i["a"])(Object(i["a"])(Object(i["a"])({},e.filter),e.orderBy),{},{page:e.currentPage}),t.next=3,c["a"].GET_ORDER_LIST_FOR_SHOP(e.curShopId,r);case 3:s=t.sent,console.log(s.data),e.tableData=s.data,e.tableData.unshift({}),e.filterTotalCnt=s.tot_count;case 8:case"end":return t.stop()}}),t)})))()},handleCurrentChange:function(e){this.currentPage=e,this.queryOrders()},handleSortChange:function(e){"num"===e.prop&&("ascending"===e.order?this.orderBy={num_asc:!0}:"descending"===e.order?this.orderBy={num_desc:!0}:this.orderBy={create_time_desc:!0}),"price"===e.prop&&("ascending"===e.order?this.orderBy={price_asc:!0}:"descending"===e.order?this.orderBy={price_desc:!0}:this.orderBy={create_time_desc:!0}),"start_time"===e.prop&&("ascending"===e.order?this.orderBy={create_time_asc:!0}:(e.order,this.orderBy={create_time_desc:!0})),console.log(this.orderBy),this.currentPage=1,this.queryOrders()},queryOrdersByCommodityName:function(){""!==this.query.commodityName?Object.assign(this.filter,{commodity_name_fuzzy:this.query.commodityName}):delete this.filter.commodity_name_fuzzy,this.currentPage=1,this.queryOrders()},queryOrdersByNum:function(){""!==this.query.num?Object.assign(this.filter,{num_exact:this.query.num}):delete this.filter.num_exact,this.currentPage=1,this.queryOrders()},queryOrdersByPrice:function(){""!==this.query.price?Object.assign(this.filter,{price_exact:this.query.price}):delete this.filter.price_exact,this.currentPage=1,this.queryOrders()},queryOrdersByUsername:function(){""!==this.query.username?Object.assign(this.filter,{username_fuzzy:this.query.username}):delete this.filter.username_fuzzy,this.currentPage=1,this.queryOrders()},queryOrdersByStatus:function(){""!==this.query.status?Object.assign(this.filter,{status_exact:this.query.status}):delete this.filter.status_exact,this.currentPage=1,this.queryOrders()},queryOrdersByStartTime:function(){null!==this.query.startTime&&""!==this.query.startTime?Object.assign(this.filter,{create_date:this.query.startTime}):delete this.filter.create_date,this.currentPage=1,this.queryOrders()},getOrderDetails:function(e){var t=this;return Object(l["a"])(Object(n["a"])().mark((function r(){return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.drawer=!0,r.next=3,c["a"].GET_ORDER_DETAILS(e);case 3:t.curOrderDetails=r.sent,console.log(t.curOrderDetails);case 5:case"end":return r.stop()}}),r)})))()},deliverCommodity:function(e){var t=this;return Object(l["a"])(Object(n["a"])().mark((function r(){return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("是否已经发货","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"});case 2:return r.next=4,c["a"].DELIVER_COMMODITY(e);case 4:return r.next=6,t.queryOrders();case 6:t.$Message.success("发货成功！");case 7:case"end":return r.stop()}}),r)})))()}},watch:{curShopId:{handler:function(e){this.queryOrders()}}},mounted:function(){var e=this;this.getShopList().then((function(){0===e.shopList.length?(e.$router.push({path:"/shop/create"}),e.$Message.warning("您还没有创建店铺!")):e.curShopId=e.shopList[0].id}))}},d=o,m=r("e607"),p=Object(m["a"])(d,s,a,!1,null,"5fab251c",null);t["default"]=p.exports},bc59:function(e,t,r){"use strict";var s=r("aea8"),a=r("77ee"),i=r("98f2"),n=r("f4cd"),l=r("2df7"),c=r("97a8"),u=1!==[].unshift(0),o=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}();s({target:"Array",proto:!0,arity:1,forced:u||o},{unshift:function(e){var t=a(this),r=i(t),s=arguments.length;if(s){c(r+s);var u=r;while(u--){var o=u+s;u in t?t[o]=t[u]:l(t,o)}for(var d=0;d<s;d++)t[d]=arguments[d]}return n(t,r+s)}})}}]);